(()=>{"use strict";const e=()=>`rgb(${Math.floor(256*Math.random())},${Math.floor(256*Math.random())},${Math.floor(255*Math.random())})`;class t{constructor(){this.element=document.querySelector(".snake"),this.head=document.querySelector(".snake>div"),this.body=this.element.getElementsByTagName("div"),this.init()}init(){this.head.style.backgroundColor=e()}get X(){return this.head.offsetLeft}get Y(){return this.head.offsetTop}set X(e){if(this.X!==e){if(e<0||e>490)throw new Error("蛇撞墙了!");this.body[1]&&this.body[1].offsetLeft==e&&(e=e>this.X?this.X-10:this.X+10),this.moveBody(),this.head.style.left=`${e}px`,this.checkHandBody()}}set Y(e){if(this.Y!==e){if(e<0||e>490)throw new Error("蛇撞墙了!");this.body[1]&&this.body[1].offsetTop==e&&(e=e>this.Y?this.Y-10:this.Y+10),this.moveBody(),this.head.style.top=`${e}px`,this.checkHandBody()}}addBody(){let t=document.createElement("div");t.style.backgroundColor=e(),this.element.appendChild(t)}moveBody(){for(let e=this.body.length-1;e>0;e--)this.body[e].style.top=this.body[e-1].offsetTop+"px",this.body[e].style.left=this.body[e-1].offsetLeft+"px"}checkHandBody(){for(let e=3;e<this.body.length;e++)if(this.X==this.body[e].offsetLeft&&this.Y==this.body[e].offsetTop)throw new Error("撞到自己了!")}}class s{constructor(){this.element=document.querySelector(".food"),this.divs=this.element.getElementsByTagName("div"),this.change()}change(){let t=10*Math.floor(50*Math.random()),s=10*Math.floor(50*Math.random());this.element.style.top=`${t}px`,this.element.style.left=`${s}px`,Array.from(this.divs).forEach((t=>{t.style.backgroundColor=e()}))}get X(){return this.element.offsetLeft}get Y(){return this.element.offsetTop}}class o{constructor(e=10,t=10){this.score=0,this.level=1,this.scoreElement=document.querySelector(".score"),this.levelElement=document.querySelector(".level"),this.maxLevel=e,this.upScore=t}addScore(){this.score++,this.scoreElement.innerHTML=this.score.toString(),this.score%this.upScore==0&&this.levelUp()}levelUp(){this.level<this.maxLevel&&(this.level++,this.levelElement.innerHTML=this.level.toString())}}new class{constructor(){this.direction="",this.isGameOver=!0,this.snake=new t,this.food=new s,this.scoreBoard=new o(10,1),this.init()}init(){document.addEventListener("keydown",this.keydown.bind(this)),this.move()}keydown(e){this.direction=e.key.toLowerCase().split("arrow")[1]}move(){let e=this.snake.X,t=this.snake.Y;switch(this.direction){case"right":e+=10;break;case"left":e-=10;break;case"up":t-=10;break;case"down":t+=10}this.checkEat(e,t);try{this.snake.X=e,this.snake.Y=t}catch(e){this.isGameOver=!1,alert(e.message+"游戏结束")}this.isGameOver&&setTimeout(this.move.bind(this),300-30*(this.scoreBoard.level-1))}checkEat(e,t){e===this.food.X&&t===this.food.Y&&(this.snake.addBody(),this.food.change(),this.scoreBoard.addScore())}}})();